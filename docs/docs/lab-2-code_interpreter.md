## Introduction

The Azure AI Agent Service Code Interpreter enables the LLM to generate Python code for tasks such as creating charts or performing complex data analyses based on user queries. It leverages natural language processing (NLP), sales data from an SQLite database, and user prompts to automate code generation. The LLM-generated Python code executes within a secure sandbox environment, utilizing a restricted subset of Python to ensure safe and controlled execution.

## Lab Exercise

In this lab, you'll enable the Code Interpreter to execute Python code generated by the LLM.

1. Open the `main.py`.

1. **Uncomment** the following lines by removing the **"# "** characters

    ```python
    # INSTRUCTIONS_FILE = "instructions/instructions_code_interpreter.txt
    # code_interpreter = CodeInterpreterTool()
    # toolset.add(code_interpreter)
    ```

    !!! warning
        The lines to be uncommented are not adjacent. When removing the # character, ensure you also delete the space that follows it.

1. Review the code in the `main.py` file.

    After uncommenting, your code should look like this:

    ``` python
    INSTRUCTIONS_FILE = "instructions/instructions_function_calling.txt"
    INSTRUCTIONS_FILE = "instructions/instructions_code_interpreter.txt"
    # INSTRUCTIONS_FILE = "instructions/instructions_file_search.txt"
    # INSTRUCTIONS_FILE = "instructions/instructions_code_bing_grounding.txt"


    async def add_agent_tools():
        """Add tools for the agent."""
    
        # Add the functions tool
        toolset.add(functions)

        # Add the code interpreter tool
        code_interpreter = CodeInterpreterTool()
        toolset.add(code_interpreter)

        # Add the file search tool
        # vector_store = await utilities.create_vector_store(project_client, DATA_SHEET_FILE)
        # file_search_tool = FileSearchTool(vector_store_ids=[vector_store.id])
        # toolset.add(file_search_tool)

        # Add the Bing grounding tool
        # bing_connection = await project_client.connections.get(connection_name=BING_CONNECTION_NAME)
        # bing_grounding = BingGroundingTool(connection_id=bing_connection.id)
        # toolset.add(bing_grounding)
    ```

### Review the Instructions

Review the **instructions/instructions_code_interpreter.txt** file. This file provides the LLM with specific instructions on how to utilize the Code Interpreter in the **Tools** section.

### Run the Agent App

1. Press <kbd>F5</kbd> to run the app.
2. In the terminal, the app will start, and the agent app will prompt you to  **Enter your query**.

### Start a Conversation with the Agent

1. Example Query:

    **Show sales by region as a pie chart**.

    !!! info
        The LLM uses the **async_fetch_sales_data_using_sqlite_query** function to retrieve data from the SQLite database, generates Python code for a pie chart, and the Code Interpreter executes it to create the chart.

2. View the Generated Chart:

   - After the task completes, the generated pie chart image will be saved in the **files** folder.
   - Click on the image to view the pie chart in Visual Studio Code.

3. Download Files:

    Type **Download**

    !!! info
        By default, the instructions specify that data downloads in CSV format. You can request other formats, such as JSON or Excel, by including the desired format in your query (e.g., ‘Download as JSON’).

    Try typing **Download as JSON**

4. Ask More Questions:

    - Continue asking questions about Contoso sales data to see the Code Interpreter in action.

## Stop the Agent App

When you're done, press <kbd>Shift</kbd>+<kbd>F5</kbd> or click the **Stop** button to stop the debugger.
